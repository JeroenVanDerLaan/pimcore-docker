#!/usr/bin/env sh

[ -z "${MYSQL_HOST+x}" ] && MYSQL_HOST="mysql"
[ -z "${MYSQL_PORT+x}" ] && MYSQL_PORT=3306
[ -z "${MYSQL_USER+x}" ] && MYSQL_USER="admin"
[ -z "${MYSQL_PASSWORD+x}" ] && MYSQL_PASSWORD="admin"
[ -z "${MYSQL_DATABASE+x}" ] && MYSQL_DATABASE="pimcore"
[ -z "${PIMCORE_USER+x}" ] && PIMCORE_USER="admin"
[ -z "${PIMCORE_PASSWORD+x}" ] && PIMCORE_PASSWORD="admin"

installer="$(realpath ./vendor/bin/pimcore-install)"
if [ ! -x "$installer" ]; then
    echo "Pimcore installer $installer is not available" >&2
    exit 1
fi

set -a
PIMCORE_INSTALL_ADMIN_USERNAME="$PIMCORE_USER"
PIMCORE_INSTALL_ADMIN_PASSWORD="$PIMCORE_PASSWORD"
PIMCORE_INSTALL_MYSQL_HOST_SOCKET="$MYSQL_HOST"
PIMCORE_INSTALL_MYSQL_PORT="$MYSQL_PORT"
PIMCORE_INSTALL_MYSQL_USERNAME="$MYSQL_USER"
PIMCORE_INSTALL_MYSQL_PASSWORD="$MYSQL_PASSWORD"
PIMCORE_INSTALL_MYSQL_DATABASE="$MYSQL_DATABASE"
PIMCORE_INSTALL_SKIP_DATABASE_STRUCTURE="false"
PIMCORE_INSTALL_SKIP_DATABASE_DATA="false"
PIMCORE_INSTALL_SKIP_DATABASE_DATA_DUMP="false"
set +a

sh -c "$installer --ignore-existing-config --no-interaction"
exit $?